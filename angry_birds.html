<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•µê·¸ë¦¬ë²„ë“œ ê²Œì„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 100%);
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        #gameCanvas {
            border: 3px solid #8B4513;
            border-radius: 10px;
            margin: 20px;
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 100%);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .controls {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }

        .controls h2 {
            color: #8B4513;
            margin-bottom: 10px;
        }

        .controls p {
            color: #666;
            font-size: 14px;
            margin: 5px 0;
        }

        .score-container {
            display: flex;
            align-items: center;
            gap: 20px;
            margin: 10px;
            justify-content: center;
        }

        .score {
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            color: #8B4513;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }

        .lives {
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 20px;
            color: #FF4444;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <div style="display: flex; gap: 20px; align-items: flex-start; margin-bottom: 10px;">
        <div class="controls">
            <h2>ğŸ¦ ì•µê·¸ë¦¬ë²„ë“œ ê²Œì„</h2>
            <p>ë§ˆìš°ìŠ¤ë¡œ ìƒˆë¥¼ ë“œë˜ê·¸í•´ì„œ ë°œì‚¬í•˜ì„¸ìš”!</p>
            <p>êµ¬ì¡°ë¬¼ì„ ë¶€ìˆ˜ê³  ë¼ì§€ë¥¼ ì—†ì• ì„¸ìš”!</p>
        </div>
        
        <!-- Top 3 ë­í‚¹ë³´ë“œ -->
        <div id="rankingBoard" style="background: rgba(0, 0, 0, 0.8); color: white; padding: 15px; border-radius: 10px; min-width: 200px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);">
            <h3 style="margin: 0 0 10px 0; text-align: center; color: #FFD700;">ğŸ† Top 3 ë­í‚¹</h3>
            <div id="rankingList" style="font-size: 14px;">
                <div style="margin-bottom: 5px;">1. -</div>
                <div style="margin-bottom: 5px;">2. -</div>
                <div style="margin-bottom: 5px;">3. -</div>
            </div>
        </div>
    </div>
    
    <div class="score-container">
        <div class="lives" id="lives">â¤ï¸â¤ï¸â¤ï¸</div>
        <div class="score" id="score">ì ìˆ˜: 0</div>
        <button id="musicToggle" style="padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">ğŸµ ìŒì•… ì¼œê¸°</button>
    </div>
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <audio id="bgMusic" loop>
        <source src="angry_birds_theme.mp3" type="audio/mpeg">
    </audio>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const livesElement = document.getElementById('lives');

        let score = 0;
        let lives = 3;  // ëª©ìˆ¨ 3ê°œ
        let birds = [];
        let pigs = [];
        let blocks = [];
        let slingshot = { x: 100, y: 500 };
        let currentBird = null;
        let isDragging = false;
        let dragStart = { x: 0, y: 0 };
        let scoreAnimations = [];
        let highScores = JSON.parse(localStorage.getItem('angryBirdsHighScores') || '[]');

        // ë¬¼ë¦¬ ìƒìˆ˜
        const gravity = 0.5;
        const friction = 0.99;

        // ìƒˆ ì´ë¯¸ì§€ ë¡œë“œ
        const birdImage = new Image();
        birdImage.src = 'bird2.png';

        // ë¼ì§€ ì´ë¯¸ì§€ ë¡œë“œ
        const pigImage = new Image();
        pigImage.src = 'pig.png';

        // ìƒˆ í´ë˜ìŠ¤
        class Bird {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = 0;
                this.vy = 0;
                this.radius = 25;  // í¬ê¸°ë¥¼ 15ì—ì„œ 25ë¡œ ì¦ê°€
                this.color = '#FF4444';
                this.isLaunched = false;
            }

            update() {
                if (this.isLaunched) {
                    this.vy += gravity;
                    this.vx *= friction;
                    this.x += this.vx;
                    this.y += this.vy;
                }
            }

            draw() {
                // ìƒˆ ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
                if (birdImage.complete) {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    
                    // ìƒˆê°€ ë‚ ì•„ê°€ëŠ” ë°©í–¥ì— ë”°ë¼ íšŒì „
                    if (this.isLaunched && (this.vx !== 0 || this.vy !== 0)) {
                        const angle = Math.atan2(this.vy, this.vx);
                        ctx.rotate(angle);
                    }
                    
                    ctx.drawImage(birdImage, -this.radius, -this.radius, this.radius * 2, this.radius * 2);
                    ctx.restore();
                } else {
                    // ì´ë¯¸ì§€ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ì„ ë•Œ ê¸°ë³¸ ì›í˜• ê·¸ë¦¬ê¸°
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                    ctx.strokeStyle = '#8B0000';
                    ctx.lineWidth = 2;
                    ctx.stroke();

                    // ëˆˆ ê·¸ë¦¬ê¸°
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    ctx.arc(this.x - 5, this.y - 5, 3, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = 'black';
                    ctx.beginPath();
                    ctx.arc(this.x - 5, this.y - 5, 1.5, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            isOffScreen() {
                return this.x > canvas.width + 50 || this.y > canvas.height + 50;
            }
        }

        // ë¼ì§€ í´ë˜ìŠ¤
        class Pig {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.radius = 20;
                this.color = '#90EE90';
                this.isAlive = true;
            }

            draw() {
                if (!this.isAlive) return;
                
                // ë¼ì§€ ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
                if (pigImage.complete) {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.drawImage(pigImage, -this.radius, -this.radius, this.radius * 2, this.radius * 2);
                    ctx.restore();
                } else {
                    // ì´ë¯¸ì§€ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ì„ ë•Œ ê¸°ë³¸ ì›í˜• ê·¸ë¦¬ê¸°
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                    ctx.strokeStyle = '#228B22';
                    ctx.lineWidth = 2;
                    ctx.stroke();

                    // ëˆˆ ê·¸ë¦¬ê¸°
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    ctx.arc(this.x - 8, this.y - 8, 4, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(this.x + 8, this.y - 8, 4, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = 'black';
                    ctx.beginPath();
                    ctx.arc(this.x - 8, this.y - 8, 2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(this.x + 8, this.y - 8, 2, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
        }

        // ë¸”ë¡ í´ë˜ìŠ¤
        class Block {
            constructor(x, y, width, height, color) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.color = color;
                this.isDestroyed = false;
                this.vx = 0;
                this.vy = 0;
                this.isFalling = false;
            }

            update() {
                if (this.isFalling) {
                    this.vy += gravity;
                    this.y += this.vy;
                    
                    // ë•…ì— ë‹¿ìœ¼ë©´ ë©ˆì¶¤
                    if (this.y + this.height >= 550) {
                        this.y = 550 - this.height;
                        this.vy = 0;
                        this.isFalling = false;
                    }
                }
            }

            draw() {
                if (this.isDestroyed) return;
                
                ctx.save();
                ctx.translate(this.x, this.y);
                
                // ë‚˜ë¬´ ë²½ëŒ ë°°ê²½
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(0, 0, this.width, this.height);
                
                // ë‚˜ë¬´ ì¤„ë¬´ëŠ¬ (ì„¸ë¡œ)
                ctx.fillStyle = '#654321';
                for (let i = 0; i < this.width; i += 8) {
                    ctx.fillRect(i, 0, 2, this.height);
                }
                
                // ë‚˜ë¬´ ì¤„ë¬´ëŠ¬ (ê°€ë¡œ)
                ctx.fillStyle = '#A0522D';
                for (let i = 0; i < this.height; i += 10) {
                    ctx.fillRect(0, i, this.width, 2);
                }
                
                // ë‚˜ë¬´ ê²° (ë‚˜ì„ í˜•)
                ctx.strokeStyle = '#654321';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(5, 5);
                ctx.lineTo(15, 15);
                ctx.lineTo(25, 10);
                ctx.lineTo(35, 20);
                ctx.stroke();
                
                // í…Œë‘ë¦¬
                ctx.strokeStyle = '#654321';
                ctx.lineWidth = 2;
                ctx.strokeRect(0, 0, this.width, this.height);
                
                ctx.restore();
            }

            // ì¶©ëŒ ê°ì§€ (ì‚¬ê°í˜•ê³¼ ì›)
            checkCollision(circle) {
                const closestX = Math.max(this.x, Math.min(circle.x, this.x + this.width));
                const closestY = Math.max(this.y, Math.min(circle.y, this.y + this.height));
                
                const distanceX = circle.x - closestX;
                const distanceY = circle.y - closestY;
                const distanceSquared = distanceX * distanceX + distanceY * distanceY;
                
                return distanceSquared < circle.radius * circle.radius;
            }
        }

        // ì ìˆ˜ ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤
        class ScoreAnimation {
            constructor(x, y, points) {
                this.x = x;
                this.y = y;
                this.points = points;
                this.alpha = 1;
                this.vy = -2;
                this.life = 60; // 60í”„ë ˆì„ ë™ì•ˆ í‘œì‹œ
            }

            update() {
                this.y += this.vy;
                this.alpha -= 0.02;
                this.life--;
                return this.life > 0;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = '#FFD700';
                ctx.font = 'bold 24px Arial';
                ctx.textAlign = 'center';
                ctx.strokeStyle = '#FF8C00';
                ctx.lineWidth = 2;
                ctx.strokeText(`+${this.points}`, this.x, this.y);
                ctx.fillText(`+${this.points}`, this.x, this.y);
                ctx.restore();
            }
        }

        // ì ìˆ˜ ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ í•¨ìˆ˜
        function addScoreAnimation(x, y, points) {
            scoreAnimations.push(new ScoreAnimation(x, y, points));
        }

        // ëª©ìˆ¨ í‘œì‹œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateLivesDisplay() {
            const hearts = 'â¤ï¸'.repeat(lives);
            livesElement.textContent = hearts;
        }

        let showingVictoryScreen = false; // ìŠ¹ë¦¬ í™”ë©´ í‘œì‹œ ìƒíƒœ
        let currentScore = 0; // í˜„ì¬ ì ìˆ˜ ì €ì¥

        // ì ìˆ˜ ê¸°ë¡ í•¨ìˆ˜
        function saveHighScore(score) {
            const playerName = prompt('ìƒˆë¡œìš´ ê¸°ë¡! ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:') || 'í”Œë ˆì´ì–´';
            const newScore = {
                name: playerName,
                score: score,
                date: new Date().toLocaleDateString()
            };
            
            highScores.push(newScore);
            highScores.sort((a, b) => b.score - a.score); // ë†’ì€ ì ìˆ˜ìˆœ ì •ë ¬
            highScores = highScores.slice(0, 5); // ìƒìœ„ 5ê°œë§Œ ìœ ì§€
            
            localStorage.setItem('angryBirdsHighScores', JSON.stringify(highScores));
            updateRankingBoard(); // ë­í‚¹ë³´ë“œ ì—…ë°ì´íŠ¸
        }

        // ë­í‚¹ ì´ë¦„ ì…ë ¥ í•¨ìˆ˜
        function showRankingInput() {
            const playerName = prompt('ìƒˆë¡œìš´ ê¸°ë¡! ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:') || 'í”Œë ˆì´ì–´';
            const newScore = {
                name: playerName,
                score: currentScore,
                date: new Date().toLocaleDateString()
            };
            
            highScores.push(newScore);
            highScores.sort((a, b) => b.score - a.score); // ë†’ì€ ì ìˆ˜ìˆœ ì •ë ¬
            highScores = highScores.slice(0, 5); // ìƒìœ„ 5ê°œë§Œ ìœ ì§€
            
            localStorage.setItem('angryBirdsHighScores', JSON.stringify(highScores));
            updateRankingBoard(); // ë­í‚¹ë³´ë“œ ì—…ë°ì´íŠ¸
            
            // ìŠ¹ë¦¬ í™”ë©´ ì¢…ë£Œ
            showingVictoryScreen = false;
        }

        // ë­í‚¹ë³´ë“œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateRankingBoard() {
            const rankingList = document.getElementById('rankingList');
            const top3 = highScores.slice(0, 3); // ìƒìœ„ 3ê°œë§Œ
            
            let rankingHTML = '';
            for (let i = 0; i < 3; i++) {
                if (i < top3.length) {
                    const score = top3[i];
                    const medal = i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : 'ğŸ¥‰';
                    rankingHTML += `<div style="margin-bottom: 5px; ${i === 0 ? 'color: #FFD700; font-weight: bold;' : i === 1 ? 'color: #C0C0C0; font-weight: bold;' : i === 2 ? 'color: #CD7F32; font-weight: bold;' : ''}">${medal} ${score.name}: ${score.score}ì </div>`;
                } else {
                    rankingHTML += `<div style="margin-bottom: 5px; color: #888;">${i + 1}. -</div>`;
                }
            }
            
            rankingList.innerHTML = rankingHTML;
        }

        let showingHighScores = false; // ìµœê³  ì ìˆ˜ í™”ë©´ í‘œì‹œ ìƒíƒœ

        // ìµœê³  ì ìˆ˜ í‘œì‹œ í•¨ìˆ˜
        function showHighScores() {
            if (highScores.length === 0) return;
            
            showingHighScores = true;
            
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = 'white';
            ctx.font = 'bold 32px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ğŸ† ìµœê³  ì ìˆ˜ ğŸ†', canvas.width / 2, 150);
            
            ctx.font = '20px Arial';
            highScores.forEach((score, index) => {
                const y = 200 + index * 40;
                ctx.fillText(`${index + 1}. ${score.name}: ${score.score}ì  (${score.date})`, canvas.width / 2, y);
            });
            
            ctx.font = '16px Arial';
            ctx.fillText('ì•„ë¬´ í‚¤ë‚˜ ëˆ„ë¥´ë©´ ë‹¤ì‹œ ì‹œì‘', canvas.width / 2, 450);
        }

        // ì¶©ëŒ ê°ì§€
        function checkCollision(obj1, obj2) {
            const dx = obj1.x - obj2.x;
            const dy = obj1.y - obj2.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            return distance < obj1.radius + obj2.radius;
        }



        // ê²Œì„ ì´ˆê¸°í™”
        function initGame() {
            // ìƒˆ ìƒì„±
            birds = [new Bird(slingshot.x, slingshot.y)];
            currentBird = birds[0];

            // ë¼ì§€ ìƒì„± (ë²½ëŒì— ê¹”ë¦´ ë“¯ì´ ë°°ì¹˜)
            pigs = [
                new Pig(680, 500),  // ë²½ëŒ ë’¤ (ì˜¤ë¥¸ìª½)
                new Pig(720, 500),  // ë²½ëŒ ë’¤ (ì˜¤ë¥¸ìª½)
                new Pig(760, 500),  // ë²½ëŒ ë’¤ (ì˜¤ë¥¸ìª½)
                new Pig(640, 520),  // ë²½ëŒ ì•„ë˜ (ê¹”ë¦´ ë“¯)
                new Pig(680, 520),  // ë²½ëŒ ì•„ë˜ (ê¹”ë¦´ ë“¯)
                new Pig(720, 520),  // ë²½ëŒ ì•„ë˜ (ê¹”ë¦´ ë“¯)
                new Pig(500, 500),  // ë²½ëŒ ì‚¬ì´ (1ì¸µ)
                new Pig(580, 500),  // ë²½ëŒ ì‚¬ì´ (1ì¸µ)
                new Pig(540, 450),  // ë²½ëŒ ì‚¬ì´ (2ì¸µ)
                new Pig(600, 450),  // ë²½ëŒ ì‚¬ì´ (2ì¸µ)
                new Pig(560, 400),  // ë²½ëŒ ì‚¬ì´ (3ì¸µ)
                new Pig(540, 350),  // ë²½ëŒ ì‚¬ì´ (4ì¸µ)
                new Pig(580, 350)   // ë²½ëŒ ì‚¬ì´ (4ì¸µ)
            ];

            // ë¸”ë¡ ìƒì„± (ë” ì™¼ìª½ì— ìœ„ì¹˜, ë‚©ì‘í•œ ë²½ëŒê³¼ ì„ì„, ë•…ì— ë¶™ì–´ìˆìŒ)
            blocks = [
                // 1ì¸µ (ë°”ë‹¥) - ë•…ì— ë¶™ì–´ìˆìŒ
                new Block(400, 500, 40, 30, '#8B4513'),  // ë‚©ì‘í•œ ë²½ëŒ
                new Block(440, 500, 40, 50, '#8B4513'),  // ì¼ë°˜ ë²½ëŒ
                new Block(480, 500, 40, 30, '#8B4513'),  // ë‚©ì‘í•œ ë²½ëŒ
                new Block(520, 500, 40, 50, '#8B4513'),  // ì¼ë°˜ ë²½ëŒ
                new Block(560, 500, 40, 30, '#8B4513'),  // ë‚©ì‘í•œ ë²½ëŒ
                new Block(600, 500, 40, 50, '#8B4513'),  // ì¼ë°˜ ë²½ëŒ
                new Block(640, 500, 40, 30, '#8B4513'),  // ë‚©ì‘í•œ ë²½ëŒ
                
                // 2ì¸µ - ë‚©ì‘í•œ ë²½ëŒê³¼ ì„ì„
                new Block(420, 450, 40, 30, '#8B4513'),  // ë‚©ì‘í•œ ë²½ëŒ
                new Block(460, 450, 40, 50, '#8B4513'),  // ì¼ë°˜ ë²½ëŒ
                new Block(500, 450, 40, 30, '#8B4513'),  // ë‚©ì‘í•œ ë²½ëŒ
                new Block(540, 450, 40, 50, '#8B4513'),  // ì¼ë°˜ ë²½ëŒ
                new Block(580, 450, 40, 30, '#8B4513'),  // ë‚©ì‘í•œ ë²½ëŒ
                new Block(620, 450, 40, 50, '#8B4513'),  // ì¼ë°˜ ë²½ëŒ
                
                // 3ì¸µ - ë‚©ì‘í•œ ë²½ëŒê³¼ ì„ì„
                new Block(440, 400, 40, 30, '#8B4513'),  // ë‚©ì‘í•œ ë²½ëŒ
                new Block(480, 400, 40, 50, '#8B4513'),  // ì¼ë°˜ ë²½ëŒ
                new Block(520, 400, 40, 30, '#8B4513'),  // ë‚©ì‘í•œ ë²½ëŒ
                new Block(560, 400, 40, 50, '#8B4513'),  // ì¼ë°˜ ë²½ëŒ
                new Block(600, 400, 40, 30, '#8B4513'),  // ë‚©ì‘í•œ ë²½ëŒ
                
                // 4ì¸µ - ë‚©ì‘í•œ ë²½ëŒê³¼ ì„ì„
                new Block(460, 350, 40, 30, '#8B4513'),  // ë‚©ì‘í•œ ë²½ëŒ
                new Block(500, 350, 40, 50, '#8B4513'),  // ì¼ë°˜ ë²½ëŒ
                new Block(540, 350, 40, 30, '#8B4513'),  // ë‚©ì‘í•œ ë²½ëŒ
                new Block(580, 350, 40, 50, '#8B4513'),  // ì¼ë°˜ ë²½ëŒ
                
                // 5ì¸µ (ê¼­ëŒ€ê¸°) - ë‚©ì‘í•œ ë²½ëŒê³¼ ì„ì„
                new Block(480, 300, 40, 30, '#8B4513'),  // ë‚©ì‘í•œ ë²½ëŒ
                new Block(520, 300, 40, 50, '#8B4513'),  // ì¼ë°˜ ë²½ëŒ
                new Block(560, 300, 40, 30, '#8B4513')   // ë‚©ì‘í•œ ë²½ëŒ
            ];
        }

        // ìŠ¬ë§ìƒ· ê·¸ë¦¬ê¸° (Yì ëª¨ì–‘)
        function drawSlingshot() {
            // Yì ê¸°ë‘¥ (ì„¸ë¡œ ë¶€ë¶„) - ë” í¬ê²Œ
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(slingshot.x - 8, slingshot.y + 20, 16, 80);
            
            // Yì ê¸°ë‘¥ í…Œë‘ë¦¬
            ctx.strokeStyle = '#654321';
            ctx.lineWidth = 2;
            ctx.strokeRect(slingshot.x - 8, slingshot.y + 20, 16, 80);
            
            // Yì ì™¼ìª½ íŒ” - ë” í¬ê²Œ
            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.moveTo(slingshot.x - 8, slingshot.y + 20);
            ctx.lineTo(slingshot.x - 40, slingshot.y - 10);
            ctx.lineTo(slingshot.x - 35, slingshot.y - 15);
            ctx.lineTo(slingshot.x - 3, slingshot.y + 15);
            ctx.closePath();
            ctx.fill();
            
            // Yì ì˜¤ë¥¸ìª½ íŒ” - ë” í¬ê²Œ
            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.moveTo(slingshot.x + 8, slingshot.y + 20);
            ctx.lineTo(slingshot.x + 40, slingshot.y - 10);
            ctx.lineTo(slingshot.x + 35, slingshot.y - 15);
            ctx.lineTo(slingshot.x + 3, slingshot.y + 15);
            ctx.closePath();
            ctx.fill();
            
            // Yì íŒ” í…Œë‘ë¦¬
            ctx.strokeStyle = '#654321';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // ë‚˜ë¬´ ê²° (ì„¸ë¡œ ì¤„ë¬´ëŠ¬) - ë” í¬ê²Œ
            ctx.strokeStyle = '#654321';
            ctx.lineWidth = 1;
            for (let i = 0; i < 2; i++) {
                ctx.beginPath();
                ctx.moveTo(slingshot.x - 4 + i * 8, slingshot.y + 20);
                ctx.lineTo(slingshot.x - 4 + i * 8, slingshot.y + 100);
                ctx.stroke();
            }
            
            // ê³ ë¬´ì¤„ ê·¸ë¦¬ê¸° (Yì íŒ” ëì—ì„œ)
            if (currentBird && !currentBird.isLaunched) {
                // ê³ ë¬´ì¤„ ê·¸ë¦¼ì íš¨ê³¼
                ctx.strokeStyle = '#8B4513';
                ctx.lineWidth = 6;
                ctx.lineCap = 'round';
                ctx.beginPath();
                ctx.moveTo(slingshot.x - 37, slingshot.y - 12);
                ctx.lineTo(currentBird.x, currentBird.y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(slingshot.x + 37, slingshot.y - 12);
                ctx.lineTo(currentBird.x, currentBird.y);
                ctx.stroke();
                
                // ê³ ë¬´ì¤„ ë©”ì¸ (í°ìƒ‰)
                ctx.strokeStyle = '#F5F5F5';
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.moveTo(slingshot.x - 35, slingshot.y - 10);
                ctx.lineTo(currentBird.x, currentBird.y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(slingshot.x + 35, slingshot.y - 10);
                ctx.lineTo(currentBird.x, currentBird.y);
                ctx.stroke();
                
                // ê³ ë¬´ì¤„ í•˜ì´ë¼ì´íŠ¸ (ë” ë°ì€ í°ìƒ‰)
                ctx.strokeStyle = '#FFFFFF';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(slingshot.x - 33, slingshot.y - 8);
                ctx.lineTo(currentBird.x, currentBird.y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(slingshot.x + 33, slingshot.y - 8);
                ctx.lineTo(currentBird.x, currentBird.y);
                ctx.stroke();
            }
        }

        // ê²Œì„ ì—…ë°ì´íŠ¸
        function update() {
            // ìƒˆ ì—…ë°ì´íŠ¸
            birds.forEach(bird => {
                bird.update();
                
                // ë¼ì§€ì™€ ì¶©ëŒ ì²´í¬
                pigs.forEach(pig => {
                    if (pig.isAlive && checkCollision(bird, pig)) {
                        pig.isAlive = false;
                        score += 100;
                        scoreElement.textContent = `ì ìˆ˜: ${score}`;
                        addScoreAnimation(pig.x, pig.y - 30, 100);
                    }
                });

                // ë¸”ë¡ê³¼ ì¶©ëŒ ì²´í¬
                blocks.forEach(block => {
                    if (!block.isDestroyed && !block.isFalling && block.checkCollision(bird)) {
                        // ë¸”ë¡ì„ ë–¨ì–´ëœ¨ë¦¬ê¸°
                        block.isFalling = true;
                        score += 10;
                        scoreElement.textContent = `ì ìˆ˜: ${score}`;
                        addScoreAnimation(block.x + block.width/2, block.y - 20, 10);
                    }
                });
            });

            // ë¸”ë¡ ì—…ë°ì´íŠ¸
            blocks.forEach(block => {
                block.update();
                
                // ë–¨ì–´ì§€ëŠ” ë¸”ë¡ì´ ë¼ì§€ì™€ ì¶©ëŒí•˜ëŠ”ì§€ ì²´í¬
                if (block.isFalling) {
                    pigs.forEach(pig => {
                        if (pig.isAlive && 
                            block.x < pig.x + pig.radius &&
                            block.x + block.width > pig.x - pig.radius &&
                            block.y < pig.y + pig.radius &&
                            block.y + block.height > pig.y - pig.radius) {
                            pig.isAlive = false;
                            score += 200;
                            scoreElement.textContent = `ì ìˆ˜: ${score}`;
                            addScoreAnimation(pig.x, pig.y - 30, 200);
                        }
                    });
                }
            });

            // ì ìˆ˜ ì• ë‹ˆë©”ì´ì…˜ ì—…ë°ì´íŠ¸
            scoreAnimations = scoreAnimations.filter(animation => animation.update());

            // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°„ ìƒˆ ì œê±°
            birds = birds.filter(bird => !bird.isOffScreen());

            // ìƒˆ ìƒˆ ìƒì„± (ëª©ìˆ¨ì´ ìˆì„ ë•Œë§Œ)
            if (birds.length === 0 && !isDragging && lives > 0) {
                birds.push(new Bird(slingshot.x, slingshot.y));
                currentBird = birds[0];
            }
        }

        // ì•µê·¸ë¦¬ë²„ë“œ ìŠ¤íƒ€ì¼ ë°°ê²½ ê·¸ë¦¬ê¸°
        function drawBackground() {
            // í•˜ëŠ˜ ê·¸ë¼ë°ì´ì…˜
            const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            skyGradient.addColorStop(0, '#87CEEB');
            skyGradient.addColorStop(1, '#98FB98');
            ctx.fillStyle = skyGradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // êµ¬ë¦„ ê·¸ë¦¬ê¸°
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            drawCloud(100, 80, 60);
            drawCloud(300, 120, 40);
            drawCloud(600, 100, 50);
            drawCloud(700, 150, 35);

            // ì–¸ë• ê·¸ë¦¬ê¸°
            ctx.fillStyle = '#228B22';
            ctx.beginPath();
            ctx.moveTo(0, 500);
            ctx.quadraticCurveTo(200, 450, 400, 500);
            ctx.quadraticCurveTo(600, 480, 800, 500);
            ctx.lineTo(800, 600);
            ctx.lineTo(0, 600);
            ctx.closePath();
            ctx.fill();

            // ìˆ² ê·¸ë¦¬ê¸°
            ctx.fillStyle = '#006400';
            for (let i = 0; i < 8; i++) {
                drawTree(50 + i * 100, 480, 30);
            }

            // ë•… ê·¸ë¦¬ê¸°
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(0, 550, canvas.width, 50);

            // í’€ ê·¸ë¦¬ê¸°
            ctx.fillStyle = '#228B22';
            for (let i = 0; i < 20; i++) {
                const x = i * 40;
                ctx.fillRect(x, 545, 3, 10);
                ctx.fillRect(x + 5, 548, 2, 8);
            }
        }

        // êµ¬ë¦„ ê·¸ë¦¬ê¸° í•¨ìˆ˜
        function drawCloud(x, y, size) {
            ctx.beginPath();
            ctx.arc(x, y, size * 0.5, 0, Math.PI * 2);
            ctx.arc(x + size * 0.3, y, size * 0.4, 0, Math.PI * 2);
            ctx.arc(x + size * 0.6, y, size * 0.5, 0, Math.PI * 2);
            ctx.arc(x + size * 0.3, y - size * 0.2, size * 0.3, 0, Math.PI * 2);
            ctx.fill();
        }

        // ë‚˜ë¬´ ê·¸ë¦¬ê¸° í•¨ìˆ˜
        function drawTree(x, y, size) {
            // ë‚˜ë¬´ ì¤„ê¸°
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(x - 5, y, 10, size);

            // ë‚˜ë¬´ ì
            ctx.fillStyle = '#228B22';
            ctx.beginPath();
            ctx.arc(x, y - 10, size * 0.8, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(x - size * 0.3, y - 5, size * 0.6, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(x + size * 0.3, y - 5, size * 0.6, 0, Math.PI * 2);
            ctx.fill();
        }

        // ê²Œì„ ê·¸ë¦¬ê¸°
        function draw() {
            // ë°°ê²½ ê·¸ë¦¬ê¸°
            drawBackground();

            // ìŠ¬ë§ìƒ· ê·¸ë¦¬ê¸°
            drawSlingshot();

            // ë¸”ë¡ ê·¸ë¦¬ê¸°
            blocks.forEach(block => block.draw());

            // ë¼ì§€ ê·¸ë¦¬ê¸°
            pigs.forEach(pig => pig.draw());

            // ìƒˆ ê·¸ë¦¬ê¸°
            birds.forEach(bird => bird.draw());

            // ì ìˆ˜ ì• ë‹ˆë©”ì´ì…˜ ê·¸ë¦¬ê¸°
            scoreAnimations.forEach(animation => animation.draw());

            // ê²Œì„ ì˜¤ë²„ ì²´í¬
            const alivePigs = pigs.filter(pig => pig.isAlive).length;
            if (alivePigs === 0 && !showingHighScores && !showingVictoryScreen) {
                // ìŠ¹ë¦¬ ì‹œ
                currentScore = score; // í˜„ì¬ ì ìˆ˜ ì €ì¥
                showingVictoryScreen = true;
                
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '48px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ìŠ¹ë¦¬! ğŸ‰', canvas.width / 2, canvas.height / 2);
                ctx.font = '24px Arial';
                ctx.fillText(`ìµœì¢… ì ìˆ˜: ${score}`, canvas.width / 2, canvas.height / 2 + 50);
                
                // ë­í‚¹ ì´ë¦„ ì…ë ¥ ë²„íŠ¼ ê·¸ë¦¬ê¸°
                const buttonY = canvas.height / 2 + 100;
                const buttonWidth = 200;
                const buttonHeight = 40;
                const buttonX = canvas.width / 2 - buttonWidth / 2;
                
                // ë²„íŠ¼ ë°°ê²½
                ctx.fillStyle = '#4CAF50';
                ctx.fillRect(buttonX, buttonY, buttonWidth, buttonHeight);
                
                // ë²„íŠ¼ í…Œë‘ë¦¬
                ctx.strokeStyle = '#45a049';
                ctx.lineWidth = 2;
                ctx.strokeRect(buttonX, buttonY, buttonWidth, buttonHeight);
                
                // ë²„íŠ¼ í…ìŠ¤íŠ¸
                ctx.fillStyle = 'white';
                ctx.font = 'bold 16px Arial';
                ctx.fillText('ğŸ† ë­í‚¹ì— ê¸°ë¡í•˜ê¸°', canvas.width / 2, buttonY + 25);
                
                // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
                canvas.addEventListener('click', function handleVictoryClick(e) {
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    if (x >= buttonX && x <= buttonX + buttonWidth && 
                        y >= buttonY && y <= buttonY + buttonHeight) {
                        canvas.removeEventListener('click', handleVictoryClick);
                        showRankingInput();
                    }
                });
                
            } else if (lives === 0 && birds.length === 0 && !showingHighScores) {
                // ëª©ìˆ¨ì´ ì—†ê³  ìƒˆë„ ì—†ìœ¼ë©´ ê²Œì„ ì˜¤ë²„
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '48px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ê²Œì„ ì˜¤ë²„! ğŸ’”', canvas.width / 2, canvas.height / 2);
                ctx.font = '24px Arial';
                ctx.fillText(`ìµœì¢… ì ìˆ˜: ${score}`, canvas.width / 2, canvas.height / 2 + 50);
                ctx.font = '16px Arial';
                ctx.fillText('ì•„ë¬´ í‚¤ë‚˜ ëˆ„ë¥´ë©´ ìµœê³  ì ìˆ˜ ë³´ê¸°', canvas.width / 2, canvas.height / 2 + 80);
                
                // ìµœê³  ì ìˆ˜ í‘œì‹œ
                setTimeout(() => {
                    showHighScores();
                }, 2000);
            }
        }

        // ê²Œì„ ë£¨í”„
        function gameLoop() {
            update();
            draw();
            
            // ìµœê³  ì ìˆ˜ í™”ë©´ì´ í‘œì‹œ ì¤‘ì´ë©´ ê³„ì† ê·¸ë¦¬ê¸°
            if (showingHighScores) {
                showHighScores();
            }
            
            // ìŠ¹ë¦¬ í™”ë©´ì´ í‘œì‹œ ì¤‘ì´ë©´ ê³„ì† ê·¸ë¦¬ê¸°
            if (showingVictoryScreen) {
                const alivePigs = pigs.filter(pig => pig.isAlive).length;
                if (alivePigs === 0) {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = 'white';
                    ctx.font = '48px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('ìŠ¹ë¦¬! ğŸ‰', canvas.width / 2, canvas.height / 2);
                    ctx.font = '24px Arial';
                    ctx.fillText(`ìµœì¢… ì ìˆ˜: ${currentScore}`, canvas.width / 2, canvas.height / 2 + 50);
                    
                    // ë­í‚¹ ì´ë¦„ ì…ë ¥ ë²„íŠ¼ ê·¸ë¦¬ê¸°
                    const buttonY = canvas.height / 2 + 100;
                    const buttonWidth = 200;
                    const buttonHeight = 40;
                    const buttonX = canvas.width / 2 - buttonWidth / 2;
                    
                    // ë²„íŠ¼ ë°°ê²½
                    ctx.fillStyle = '#4CAF50';
                    ctx.fillRect(buttonX, buttonY, buttonWidth, buttonHeight);
                    
                    // ë²„íŠ¼ í…Œë‘ë¦¬
                    ctx.strokeStyle = '#45a049';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(buttonX, buttonY, buttonWidth, buttonHeight);
                    
                    // ë²„íŠ¼ í…ìŠ¤íŠ¸
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 16px Arial';
                    ctx.fillText('ğŸ† ë­í‚¹ì— ê¸°ë¡í•˜ê¸°', canvas.width / 2, buttonY + 25);
                }
            }
            
            requestAnimationFrame(gameLoop);
        }

        // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
        canvas.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            if (currentBird && !currentBird.isLaunched) {
                const dx = x - currentBird.x;
                const dy = y - currentBird.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                if (distance < 50) {
                    isDragging = true;
                    dragStart = { x, y };
                }
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDragging && currentBird && !currentBird.isLaunched) {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                const dx = x - slingshot.x;
                const dy = y - slingshot.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                if (distance < 100) {
                    currentBird.x = x;
                    currentBird.y = y;
                }
            }
        });

        canvas.addEventListener('mouseup', (e) => {
            if (isDragging && currentBird && !currentBird.isLaunched) {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                const dx = slingshot.x - x;
                const dy = slingshot.y - y;
                
                currentBird.vx = dx * 0.3;
                currentBird.vy = dy * 0.3;
                currentBird.isLaunched = true;
                
                isDragging = false;
                
                // ëª©ìˆ¨ ê°ì†Œ
                lives--;
                updateLivesDisplay();
            }
        });

        // ìŒì•… ì»¨íŠ¸ë¡¤
        const bgMusic = document.getElementById('bgMusic');
        const musicToggle = document.getElementById('musicToggle');
        let isMusicPlaying = false;

        musicToggle.addEventListener('click', () => {
            if (isMusicPlaying) {
                bgMusic.pause();
                musicToggle.textContent = 'ğŸµ ìŒì•… ì¼œê¸°';
                isMusicPlaying = false;
            } else {
                bgMusic.play();
                musicToggle.textContent = 'ğŸ”‡ ìŒì•… ë„ê¸°';
                isMusicPlaying = true;
            }
        });

        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ (ìµœê³  ì ìˆ˜ í™”ë©´ì—ì„œ ê²Œì„ ì¬ì‹œì‘)
        document.addEventListener('keydown', (e) => {
            if (showingHighScores) {
                // ìµœê³  ì ìˆ˜ í™”ë©´ì—ì„œ ì•„ë¬´ í‚¤ë‚˜ ëˆ„ë¥´ë©´ ê²Œì„ ì¬ì‹œì‘
                showingHighScores = false;
                initGame();
                score = 0;
                lives = 3;
                updateLivesDisplay();
                scoreElement.textContent = `ì ìˆ˜: ${score}`;
            }
        });

        // ê²Œì„ ì‹œì‘
        initGame();
        updateRankingBoard(); // ì´ˆê¸° ë­í‚¹ë³´ë“œ í‘œì‹œ
        gameLoop();
    </script>
</body>
</html> 